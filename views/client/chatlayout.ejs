<!doctype html>
<html lang="en">
  <head>
    <title>Chat</title>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    
    
    <link rel="stylesheet" href="client/css/index.css">
   <link rel="stylesheet" href="client/css/style.css">
    <link rel="stylesheet" href="client/css/chatlayout.css">
   <!-- fav icon -->
   <link rel="icon" href="client/images/icon.png">

   <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet">
   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" />
  
  </head>
  <% include ./layout/menu.ejs %>
<div class="container messaging-content">
<div class="messaging">
      <div class="inbox_msg">
        <div class="inbox_people">
          <div class="headind_srch">
            <div class="recent_heading">
              <h4>Recent</h4>
            </div>
            <div class="srch_bar">
              <div class="stylish-input-group">
                <input type="text" class="search-bar"  placeholder="Search" >
                <span class="input-group-addon">
                <button type="button"> <i class="fa fa-search" aria-hidden="true"></i> </button>
                </span> </div>
            </div>
          </div>
          <div class="inbox_chat">
            <div class="chat_list active_chat">
              <div class="chat_people">
                <div class="chat_img"> <img src="https://ptetutorials.com/images/user-profile.png" alt="sunil"> </div>
                <div class="chat_ib">
                  <h5>Sunil Rajput <span class="chat_date">Dec 25</span></h5>
                  <p>Test, which is a new approach to have all solutions 
                    astrology under one roof.</p>
                </div>
              </div>
            </div>
            <div class="chat_list">
              <div class="chat_people">
                <div class="chat_img"> <img src="https://ptetutorials.com/images/user-profile.png" alt="sunil"> </div>
                <div class="chat_ib">
                  <h5>Sunil Rajput <span class="chat_date">Dec 25</span></h5>
                  <p>Test, which is a new approach to have all solutions 
                    astrology under one roof.</p>
                </div>
              </div>
            </div>
            <div class="chat_list">
              <div class="chat_people">
                <div class="chat_img"> <img src="https://ptetutorials.com/images/user-profile.png" alt="sunil"> </div>
                <div class="chat_ib">
                  <h5>Sunil Rajput <span class="chat_date">Dec 25</span></h5>
                  <p>Test, which is a new approach to have all solutions 
                    astrology under one roof.</p>
                </div>
              </div>
            </div>
          
           
        
          
          </div>
        </div>
        <div class="mesgs">
          <div class="msg_history">
            <div class="incoming_msg">
            <!--  <div class="incoming_msg_img"> <img src="https://ptetutorials.com/images/user-profile.png" alt="sunil"> </div> -->
              <div class="received_msg chat-messages">
                <div class="received_withd_msg  message" id="messages">
                 <!-- <p>Test which is a new approach to have all
                    solutions</p>
                  <span class="time_date"> 11:01 AM    |    June 9</span> -->
                </div>
              </div>
            </div>


            <!--<div class="outgoing_msg">
              <div class="sent_msg">
                <p>Test which is a new approach to have all
                  solutions</p>
                <span class="time_date"> 11:01 AM    |    June 9</span> </div>
            </div> -->
           
           
          
             
          </div>
          <div class="type_msg">
            <div class="input_msg_write">
              <input  id="mess"  type="text" class="write_msg" placeholder="Type a message" />
              <button onClick = myFunction()   class="msg_send_btn" type="submit" > <i class="fas fa-paper-plane" aria-hidden="true"></i></button>
            </div>
          </div>
        </div>
      </div>      
    </div>
</div>
 <% include ./layout/footer.ejs %>
    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js"></script>
   <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
   <script type="text/javascript" src="//code.jquery.com/jquery-migrate-1.2.1.min.js"></script>
   <script type="text/javascript" src="//cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.min.js"></script>
   <script src="client/js/script.js"></script>
   <script type="text/javascript" src="client/js/main.js"></script>
   <script src="/socket.io/socket.io.js"></script>
   <script src="https://code.jquery.com/jquery-1.11.1.js"></script>
    <script>

   let fromUser= "<%= profileUser.FullName %>";
   let SendIDUser = "<%= profileUser._id %>";
   let toUser="<%= AuthorPost.FullName %>";
   console.log(toUser)
   let toID =" <%= AuthorPost._id %> ";
       var socket = io();
      function myFunction()
      {
        
      var n= $('#mess').val(); 
      final = {
        'senderIDUser':SendIDUser,
        'senderUser':fromUser,
        'receiverIDUser':toID,
        'receiverUser':toUser,
        'msg':$('#mess').val()
    };
    socket.emit('chat message',final );
    $('#mess').val('');   
      }

socket.on('chat message',(data) => { //recieves a message and displays it
     outputMessage(data);
   
    //chatMessages.scrollTop=chatMessages.scrollHeight;
});

function outputMessage(message) {
    const div = document.createElement('div');
    div.classList.add('message');
    div.innerHTML= `
     <p>
        ${message.message}
    </p> 
    
    <p class="meta">${message.SenderUser}<span> ${message.time}, ${message.date}</span></p>`;
   
    document.querySelector('.message').appendChild(div);
}
      /*$(function () {
         var socket = io();
         $('form').submit(function(){
           socket.emit('chat message', $('#mess').val());
           $('#mess').val('');
           return false;
         });
         socket.on('chat message', function(msg){
           $('#messages').append($('<li>').text(msg));
         });
         socket.emit('new-user', name)
          socket.on('user-connected', function(name){
            appendMessage(`${name} connected`)
          })
       });*/
    </script>
 </body>
</html>